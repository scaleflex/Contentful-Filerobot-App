import n, { useState, useCallback } from 'react';
import { cx, css } from 'emotion';
import { useCombobox } from 'downshift';
import { mergeRefs } from '@contentful/f36-core';
import { IconButton } from '@contentful/f36-button';
import { TextInput } from '@contentful/f36-forms';
import { ChevronDownIcon, CloseIcon } from '@contentful/f36-icons';
import { Skeleton } from '@contentful/f36-skeleton';
import { Popover } from '@contentful/f36-popover';
import { Subheading, SectionHeading, Text } from '@contentful/f36-typography';
import { getStringMatch } from '@contentful/f36-utils';
import a from '@contentful/f36-tokens';

var Ne=Object.defineProperty,Oe=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var J=(t,o,i)=>o in t?Ne(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,u=(t,o)=>{for(var i in o||(o={}))Q.call(o,i)&&J(t,i,o[i]);if(E)for(var i of E(o))Y.call(o,i)&&J(t,i,o[i]);return t},c=(t,o)=>Oe(t,Ve(o));var Z=(t,o)=>{var i={};for(var s in t)Q.call(t,s)&&o.indexOf(s)<0&&(i[s]=t[s]);if(t!=null&&E)for(var s of E(t))o.indexOf(s)<0&&Y.call(t,s)&&(i[s]=t[s]);return i};var H=t=>({autocomplete:css({position:"relative",width:"100%"}),combobox:css({position:"relative"}),inputField:css({paddingRight:a.spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap"}),toggleButton:css({position:"absolute",top:"1px",right:"1px",zIndex:1,padding:a.spacing2Xs,minHeight:"calc(100% - 2px)"}),content:css({overflow:"auto",maxHeight:`${t}px`}),list:css({listStyle:"none",padding:`${a.spacingXs} 0`,margin:0}),groupTitle:css({padding:`${a.spacingXs} ${a.spacingM}`,lineHeight:a.lineHeightM}),noMatchesTitle:css({color:a.gray500,margin:`${a.spacingM} 0 ${a.spacingM} 0`}),item:css({display:"block",padding:`${a.spacingXs} ${a.spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto","&:focus, &:hover":{backgroundColor:a.gray100},"&:active":{backgroundColor:a.gray200}}),disabled:css({opacity:.5,pointerEvents:"none"}),highlighted:css({backgroundColor:a.gray100}),hidden:css({display:"none"})});var k=t=>{let{items:o,elementStartIndex:i,highlightedIndex:s,getItemProps:g,renderItem:x,inputValue:C,listMaxHeight:N=180}=t,I=H(N);return n.createElement("ul",{className:I.list,"data-test-id":"cf-autocomplete-list"},o.map((h,O)=>{let f=i+O,p=g({item:h,index:f});return n.createElement(Text,c(u({},p),{as:"li",key:f,className:cx([I.item,s===f&&I.highlighted]),"data-test-id":`cf-autocomplete-list-item-${f}`}),x?x(h,C):typeof h=="string"?n.createElement(ee,{item:h,inputValue:C}):h)}))};k.displayName="AutocompleteItems";function ee({item:t,inputValue:o}){let{before:i,match:s,after:g}=getStringMatch(t,o);return n.createElement(n.Fragment,null,i,n.createElement("b",null,s),g)}ee.displayName="HighlightedItem";function qe(t,o){let {isOpen:i,onClose:s,onOpen:g,id:x,className:C,clearAfterSelect:N=!1,textOnAfterSelect:I=N?"clear":"replace",closeAfterSelect:h=!0,defaultValue:O="",selectedItem:f,items:p,inputValue:X,onInputValueChange:P,onSelectItem:ne,onFocus:V,onBlur:G,renderItem:U,icon:ie=n.createElement(ChevronDownIcon,{variant:"muted"}),itemToString:se=e=>e,isInvalid:re,isDisabled:W,isRequired:pe,isReadOnly:ae,showEmptyList:le,noMatchesMessage:me="No matches found",placeholder:ue="Search",inputRef:ce,toggleRef:de,listRef:ge,listWidth:he="auto",listMaxHeight:Ie=180,isGrouped:M=!1,isLoading:S=!1,usePortal:fe=!1,testId:ye="cf-autocomplete",popoverTestId:Te="cf-autocomplete-container",showClearButton:R}=t,m=H(Ie),[be,ve]=useState(O),b=typeof X=="undefined"?be:X,v=useCallback(e=>{ve(e),P==null||P(e);},[P]),xe=useCallback(e=>{let r=e.target.value;v(r);},[v]),Ce=L(M)?p.reduce((e,r)=>[...e,...r.options],[]):p,Pe=L(M)?p.every(e=>e.options.length===0):p.length===0,{getComboboxProps:Me,getInputProps:Se,getItemProps:q,getMenuProps:we,getToggleButtonProps:Ae,highlightedIndex:K,isOpen:Ee,openMenu:He,toggleMenu:ke}=useCombobox({isOpen:i,onIsOpenChange:({isOpen:e})=>{e?g==null||g():s==null||s();},stateReducer:(e,{type:r,changes:y})=>{switch(r){case useCombobox.stateChangeTypes.InputBlur:return c(u({},y),{inputValue:e.inputValue});case useCombobox.stateChangeTypes.InputKeyDownEnter:case useCombobox.stateChangeTypes.ItemClick:return h?y:c(u({},y),{isOpen:e.isOpen});default:return y}},items:Ce,selectedItem:f,inputValue:b,itemToString:se,onInputValueChange:({type:e,inputValue:r})=>{switch(e){case useCombobox.stateChangeTypes.InputChange:return;case useCombobox.stateChangeTypes.ItemClick:case useCombobox.stateChangeTypes.InputKeyDownEnter:{if(I==="clear"){v("");return}if(I==="preserve")return}}v(r);},onStateChange:({type:e,selectedItem:r})=>{switch(e){case useCombobox.stateChangeTypes.InputKeyDownEnter:case useCombobox.stateChangeTypes.ItemClick:r&&ne(r);break;}}}),j=Se(),w=Z(j,["aria-labelledby","id"]),Le=Me(),z=Ae(),A=we(),B=0,D=R!=null?R:b;return n.createElement("div",{"data-test-id":ye,className:cx(m.autocomplete,C),ref:o},n.createElement(Popover,{usePortal:fe,isOpen:Ee,isFullWidth:he==="full",renderOnlyWhenOpen:!1,autoFocus:!1,id:A.id},n.createElement(Popover.Trigger,null,n.createElement("div",c(u({},Le),{className:m.combobox}),n.createElement(TextInput,c(u({className:m.inputField},w),{onFocus:e=>{V==null||V(e),He();},onBlur:e=>{G==null||G(e),w.onBlur(e);},id:x,isInvalid:re,isDisabled:W,isRequired:pe,isReadOnly:ae,ref:mergeRefs(w.ref,ce),testId:"cf-autocomplete-input",placeholder:ue,onChange:e=>{w.onChange(e),xe(e);}})),n.createElement(IconButton,c(u({},z),{ref:mergeRefs(z.ref,de),"aria-label":D?"Clear":"Show list",className:m.toggleButton,variant:"transparent",icon:D?n.createElement(CloseIcon,{variant:"muted"}):ie,onClick:()=>{D?v(""):ke();},isDisabled:W,size:"small"})))),p.length>0||b.length>0||le?n.createElement(Popover.Content,c(u({},A),{ref:mergeRefs(A.ref,ge),className:m.content,testId:Te}),S&&[...Array(3)].map((e,r)=>n.createElement("div",{key:r,className:cx(m.item,m.disabled)},n.createElement(Ke,null))),!S&&Pe&&n.createElement("div",{className:m.item},n.createElement(Subheading,{className:m.noMatchesTitle},me)),!S&&L(M)&&p.map((e,r)=>{if(e.options.length<1)return;let y=n.createElement("div",{key:r},n.createElement(SectionHeading,{key:r,"data-test-id":"cf-autocomplete-grouptitle",marginBottom:"none",className:m.groupTitle},e.groupTitle),n.createElement(k,{items:e.options,highlightedIndex:K,getItemProps:q,renderItem:U,inputValue:b,elementStartIndex:B}));return B+=e.options.length,y}),!S&&!L(M)&&p.length>0&&n.createElement(k,{items:p,elementStartIndex:B,highlightedIndex:K,getItemProps:q,renderItem:U,inputValue:b})):n.createElement("div",c(u({},A),{className:cx(m.hidden)}))))}var Ke=()=>n.createElement(Skeleton.Container,{svgHeight:16},n.createElement(Skeleton.BodyText,{numberOfLines:1}));function L(t,o){return t}var ze=n.forwardRef(qe);

export { ze as Autocomplete };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map