'use strict';

var n = require('react');
var emotion = require('emotion');
var downshift = require('downshift');
var f36Core = require('@contentful/f36-core');
var f36Button = require('@contentful/f36-button');
var f36Forms = require('@contentful/f36-forms');
var f36Icons = require('@contentful/f36-icons');
var f36Skeleton = require('@contentful/f36-skeleton');
var f36Popover = require('@contentful/f36-popover');
var f36Typography = require('@contentful/f36-typography');
var f36Utils = require('@contentful/f36-utils');
var a = require('@contentful/f36-tokens');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var n__default = /*#__PURE__*/_interopDefault(n);
var a__default = /*#__PURE__*/_interopDefault(a);

var Ne=Object.defineProperty,Oe=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var J=(t,o,i)=>o in t?Ne(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,u=(t,o)=>{for(var i in o||(o={}))Q.call(o,i)&&J(t,i,o[i]);if(E)for(var i of E(o))Y.call(o,i)&&J(t,i,o[i]);return t},c=(t,o)=>Oe(t,Ve(o));var Z=(t,o)=>{var i={};for(var s in t)Q.call(t,s)&&o.indexOf(s)<0&&(i[s]=t[s]);if(t!=null&&E)for(var s of E(t))o.indexOf(s)<0&&Y.call(t,s)&&(i[s]=t[s]);return i};var H=t=>({autocomplete:emotion.css({position:"relative",width:"100%"}),combobox:emotion.css({position:"relative"}),inputField:emotion.css({paddingRight:a__default.default.spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap"}),toggleButton:emotion.css({position:"absolute",top:"1px",right:"1px",zIndex:1,padding:a__default.default.spacing2Xs,minHeight:"calc(100% - 2px)"}),content:emotion.css({overflow:"auto",maxHeight:`${t}px`}),list:emotion.css({listStyle:"none",padding:`${a__default.default.spacingXs} 0`,margin:0}),groupTitle:emotion.css({padding:`${a__default.default.spacingXs} ${a__default.default.spacingM}`,lineHeight:a__default.default.lineHeightM}),noMatchesTitle:emotion.css({color:a__default.default.gray500,margin:`${a__default.default.spacingM} 0 ${a__default.default.spacingM} 0`}),item:emotion.css({display:"block",padding:`${a__default.default.spacingXs} ${a__default.default.spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto","&:focus, &:hover":{backgroundColor:a__default.default.gray100},"&:active":{backgroundColor:a__default.default.gray200}}),disabled:emotion.css({opacity:.5,pointerEvents:"none"}),highlighted:emotion.css({backgroundColor:a__default.default.gray100}),hidden:emotion.css({display:"none"})});var k=t=>{let{items:o,elementStartIndex:i,highlightedIndex:s,getItemProps:g,renderItem:x,inputValue:C,listMaxHeight:N=180}=t,I=H(N);return n__default.default.createElement("ul",{className:I.list,"data-test-id":"cf-autocomplete-list"},o.map((h,O)=>{let f=i+O,p=g({item:h,index:f});return n__default.default.createElement(f36Typography.Text,c(u({},p),{as:"li",key:f,className:emotion.cx([I.item,s===f&&I.highlighted]),"data-test-id":`cf-autocomplete-list-item-${f}`}),x?x(h,C):typeof h=="string"?n__default.default.createElement(ee,{item:h,inputValue:C}):h)}))};k.displayName="AutocompleteItems";function ee({item:t,inputValue:o}){let{before:i,match:s,after:g}=f36Utils.getStringMatch(t,o);return n__default.default.createElement(n__default.default.Fragment,null,i,n__default.default.createElement("b",null,s),g)}ee.displayName="HighlightedItem";function qe(t,o){let {isOpen:i,onClose:s,onOpen:g,id:x,className:C,clearAfterSelect:N=!1,textOnAfterSelect:I=N?"clear":"replace",closeAfterSelect:h=!0,defaultValue:O="",selectedItem:f,items:p,inputValue:X,onInputValueChange:P,onSelectItem:ne,onFocus:V,onBlur:G,renderItem:U,icon:ie=n__default.default.createElement(f36Icons.ChevronDownIcon,{variant:"muted"}),itemToString:se=e=>e,isInvalid:re,isDisabled:W,isRequired:pe,isReadOnly:ae,showEmptyList:le,noMatchesMessage:me="No matches found",placeholder:ue="Search",inputRef:ce,toggleRef:de,listRef:ge,listWidth:he="auto",listMaxHeight:Ie=180,isGrouped:M=!1,isLoading:S=!1,usePortal:fe=!1,testId:ye="cf-autocomplete",popoverTestId:Te="cf-autocomplete-container",showClearButton:R}=t,m=H(Ie),[be,ve]=n.useState(O),b=typeof X=="undefined"?be:X,v=n.useCallback(e=>{ve(e),P==null||P(e);},[P]),xe=n.useCallback(e=>{let r=e.target.value;v(r);},[v]),Ce=L(M)?p.reduce((e,r)=>[...e,...r.options],[]):p,Pe=L(M)?p.every(e=>e.options.length===0):p.length===0,{getComboboxProps:Me,getInputProps:Se,getItemProps:q,getMenuProps:we,getToggleButtonProps:Ae,highlightedIndex:K,isOpen:Ee,openMenu:He,toggleMenu:ke}=downshift.useCombobox({isOpen:i,onIsOpenChange:({isOpen:e})=>{e?g==null||g():s==null||s();},stateReducer:(e,{type:r,changes:y})=>{switch(r){case downshift.useCombobox.stateChangeTypes.InputBlur:return c(u({},y),{inputValue:e.inputValue});case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:case downshift.useCombobox.stateChangeTypes.ItemClick:return h?y:c(u({},y),{isOpen:e.isOpen});default:return y}},items:Ce,selectedItem:f,inputValue:b,itemToString:se,onInputValueChange:({type:e,inputValue:r})=>{switch(e){case downshift.useCombobox.stateChangeTypes.InputChange:return;case downshift.useCombobox.stateChangeTypes.ItemClick:case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:{if(I==="clear"){v("");return}if(I==="preserve")return}}v(r);},onStateChange:({type:e,selectedItem:r})=>{switch(e){case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:case downshift.useCombobox.stateChangeTypes.ItemClick:r&&ne(r);break;}}}),j=Se(),w=Z(j,["aria-labelledby","id"]),Le=Me(),z=Ae(),A=we(),B=0,D=R!=null?R:b;return n__default.default.createElement("div",{"data-test-id":ye,className:emotion.cx(m.autocomplete,C),ref:o},n__default.default.createElement(f36Popover.Popover,{usePortal:fe,isOpen:Ee,isFullWidth:he==="full",renderOnlyWhenOpen:!1,autoFocus:!1,id:A.id},n__default.default.createElement(f36Popover.Popover.Trigger,null,n__default.default.createElement("div",c(u({},Le),{className:m.combobox}),n__default.default.createElement(f36Forms.TextInput,c(u({className:m.inputField},w),{onFocus:e=>{V==null||V(e),He();},onBlur:e=>{G==null||G(e),w.onBlur(e);},id:x,isInvalid:re,isDisabled:W,isRequired:pe,isReadOnly:ae,ref:f36Core.mergeRefs(w.ref,ce),testId:"cf-autocomplete-input",placeholder:ue,onChange:e=>{w.onChange(e),xe(e);}})),n__default.default.createElement(f36Button.IconButton,c(u({},z),{ref:f36Core.mergeRefs(z.ref,de),"aria-label":D?"Clear":"Show list",className:m.toggleButton,variant:"transparent",icon:D?n__default.default.createElement(f36Icons.CloseIcon,{variant:"muted"}):ie,onClick:()=>{D?v(""):ke();},isDisabled:W,size:"small"})))),p.length>0||b.length>0||le?n__default.default.createElement(f36Popover.Popover.Content,c(u({},A),{ref:f36Core.mergeRefs(A.ref,ge),className:m.content,testId:Te}),S&&[...Array(3)].map((e,r)=>n__default.default.createElement("div",{key:r,className:emotion.cx(m.item,m.disabled)},n__default.default.createElement(Ke,null))),!S&&Pe&&n__default.default.createElement("div",{className:m.item},n__default.default.createElement(f36Typography.Subheading,{className:m.noMatchesTitle},me)),!S&&L(M)&&p.map((e,r)=>{if(e.options.length<1)return;let y=n__default.default.createElement("div",{key:r},n__default.default.createElement(f36Typography.SectionHeading,{key:r,"data-test-id":"cf-autocomplete-grouptitle",marginBottom:"none",className:m.groupTitle},e.groupTitle),n__default.default.createElement(k,{items:e.options,highlightedIndex:K,getItemProps:q,renderItem:U,inputValue:b,elementStartIndex:B}));return B+=e.options.length,y}),!S&&!L(M)&&p.length>0&&n__default.default.createElement(k,{items:p,elementStartIndex:B,highlightedIndex:K,getItemProps:q,renderItem:U,inputValue:b})):n__default.default.createElement("div",c(u({},A),{className:emotion.cx(m.hidden)}))))}var Ke=()=>n__default.default.createElement(f36Skeleton.Skeleton.Container,{svgHeight:16},n__default.default.createElement(f36Skeleton.Skeleton.BodyText,{numberOfLines:1}));function L(t,o){return t}var ze=n__default.default.forwardRef(qe);

exports.Autocomplete = ze;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map